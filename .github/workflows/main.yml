name: minecraft-silver-frontend workflow

on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: executing remote ssh commands to deploy
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          port: ${{ secrets.PORT }}
          username: ${{ secrets.USER }}
          key: ${{ secrets.SSH_KEY }}
          passphrase: ${{ secrets.PASSPHRASE }}
          script: |
            # Переходим в папку проекта
            cd /home/${{ secrets.USER }}/dev/minecraft-silver-frontend/
            # Обновляем репу
            git -c credential.helper='!f() { echo "username=${{ secrets.GH_USERNAME }}"; echo "password=${{ secrets.PASSPHRASE }}"; }; f' git pull
            # Накатываем зависимости
            npm i
            # Билдим проект
            npm run build:prod

  send_message:
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - name: send message
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: ${{ github.workflow }} успешно выполнен!